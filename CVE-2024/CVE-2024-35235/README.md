
# Cupsd LPE
## Usage
1. chmod +x ./exploit.sh
2. ./exploit.sh

## Environment Setting
- Use https://old-releases.ubuntu.com/releases/noble/ubuntu-24.04-desktop-amd64.iso
	- Please turn off the network when installing the OS.
	- If the versions are different, the vulnerability is not triggered.
	- Kernel Version = 6.8.0-31
	- cups version = 2.4.7-1.2ubuntu7
- If you need to update anything, use the command below,
	- sudo apt-mark hold \*cups\*
	- sudo apt-mark hold $(dpkg -l | grep 'linux-image\|linux-headers\|linux-modules' | awk '{print $2}')

## Explain
- This Exploit use CVE-2024-35235, CVE-2024-47177, CVE-2024-5290
1. Change cupsd.conf and cups-files.conf to full write using CVE-2024-35235
2. Execute arbitrary commands (with netdev privileges) using CVE-2024-47177
3. Arbitrary commands can be executed with root privileges while loading shared objects using CVE-2024-5290

### CVE-2024-35235
when starting the cupsd server with a Listen configuration item pointing to a symbolic link, the cupsd process can be caused to perform an arbitrary chmod of the provided argument, providing world-writable access to the target.
https://nvd.nist.gov/vuln/detail/cve-2024-35235

### CVE-2024-47177
Any value passed to `FoomaticRIPCommandLine` via a PPD file will be executed as a user controlled command.
https://nvd.nist.gov/vuln/detail/CVE-2024-47177

### CVE-2024-5290
An issue was discovered in Ubuntu wpa_supplicant that resulted in loading of arbitrary shared objects, which allows a local unprivileged attacker to escalate privileges to the user that wpa_supplicant runs as (usually root).
https://nvd.nist.gov/vuln/detail/cve-2024-5290